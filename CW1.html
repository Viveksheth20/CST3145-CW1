<!DOCTYPE html>
<html lang="en">

<head>
  <title>CS3145 CW1</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.7.8/dist/vue.js"></script>

  <style>

  </style>
</head>

<body>
  <div id="app">
    <!-- Output banner and first part of navigation -->
    <nav class="navbar navbar-expand-md bg-dark fixed-top" style="background-color: black;">
      <div class="collapse navbar-collapse" id="collapsibleNavbar">
        <form class="navbar-form navbar-right" style="margin-left:1000px; margin-top:20px;">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="SEARCH" name="search">
            <div class="input-group-btn" style="background-color: black; margin-top: 0.5px; width: 40px;">
              <a href="#"><button class="btn" class="submit"
                  style="background-color: black; width: px; height: 40px; margin-top:-1px">
                  <img src="Images\search.png" style="width: 30px; height: 30px; margin-top:-5px;">
                </button></a>
            </div>
          </div>
        </form>
        <button @click="showCheckout" style="margin-left:50px; background-color: #00000000;">
          <img style="height:40px; width:50px;" src="images\basket1.png">&nbsp;&nbsp;&nbsp; <b>{{cartItemCount}}&nbsp;&nbsp;</b>
        </button>
        <button disabled='disabled' v-else><img src="images/cart.png"><b>Basket {{cartItemCount}}</b></button>
  </div>
    </nav>
    <div v-if="showProduct">
      <div class="sort" style="margin-left:1300px; margin-top:100px;">
        <select style="margin-bottom:20px; background-color:#000000; color:#ffffff;">
          <option>---SORT---</option>
          <option value="SUBJECT"><a href="#">SUBJECT</a></option>
          <option value="LOCATION"><a href="#">LOCATION</a></option>
          <option value="PRICE"><a href="#">PRICE</a></option>
          <option value="AVAILABILITY"><a href="#">AVAILABILITY</a></option>
        </select>
      </div>
      <div class="card" v-for="lesson in lessons">
        <div class="card-body text-center">
          <p><b>Subject: </b>{{lesson.subject}}</p>
          <p><b>Location: </b>{{lesson.location}}</p>
          <p><b>Price: </b>£{{lesson.price}}</p>
          <p><b>Availability: </b>{{lesson.spaces}}</p>
        </div>
        <img :src="lesson.image" style="width: 50px; margin-left: 130px; padding: 0px;"></img>
        <button disabled='disabled'  v-if="lesson.spaces === 0"><b>Add to Cart</b></button>
        <button @click="addItem(lesson)" v-if="lesson.spaces !== 0"><b>Add to Cart</b></button>
        <span v-if='lesson.spaces === 0'>All out!</span>
        <span v-else-if="lesson.spaces < 5">
            Only {{lesson.spaces }} left!
        </span>
</div>
    </div>
    <div v-else>
      <!-- the code for the checkout page -->
      <div class="card" v-for="lesson in cart" style="margin-top: 150px;">
        <div class="card-body text-center">
          <p><b>Subject: </b>{{lesson.subject}}</p>
          <p><b>Location: </b>{{lesson.location}}</p>
          <p><b>Price: </b>£{{lesson.price}}</p>
          <p><b>Availability: </b>{{lesson.spaces}}</p>
        </div>
        <img :src="lesson.image" style="width: 50px; margin-left: 130px; padding: 0px;"></img>
        <button @click="addItem(lesson)">Add to cart</button>
      </div>
    </div>
  </div>
  <script>
    let app = new Vue({
      el: "#app",
      data: {
        cart: [],
        lessons: [],
        showProduct: true,
      },

      methods: {
        addItem: function (lesson) {
          this.cart.push(lesson);
                    console.log(lesson);
                    this.lessons[lesson.id].availability -= 1;
                    console.log(this.cartCount(lesson.id));
                    console.log(this.lessons[lesson.id]);
                    console.log(this.lessons[lesson.id].availability);
                },
        showCheckout() {
          this.showProduct = this.showProduct ? false : true;
        },
        cartCount(id) {
                    let count = 0;
                    for (let i = 0; i < this.cart.length; i++) {
                        if (this.cart[i].id === id) {
                            count++;
                        }
                    }
                    return count;
                },
                canAddToCart(arrayy) {
                    return arrayy.availability > this.cartCount(arrayy.id);
                },
      },

      computed: {

        cartItemCount: function () { // the property name
          // its value is calculated when it is called
          return this.cart.length || 0;
        },
        disableCart: function () {
          return this.cartItemCount > 0;
        },
      },

      mounted() {
        // Fetch lessons data from an external JSON file using Fetch API
        fetch('lessons.json')
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {
            // Assign the fetched data to the Vue instance's data property
            this.lessons = data.lessons;
          })
          .catch(error => {
            console.error('Error fetching lessons:', error);
          });
      }
    })

  </script>
</body>

</html>